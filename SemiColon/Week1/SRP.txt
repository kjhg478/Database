-------------------------------------- 유저 추가 및 비밀번호 설정
CREATE USER JHI
IDENTIFIED BY "3333";

CREATE USER DONG
IDENTIFIED BY "1234";

CREATE USER KJH
IDENTIFIED BY "3333";

-------------------------------------- 유저 권한 설정

/* CONNECT : 서버 연결 권한 RESOURCE : DML 구문 권한 */
GRANT CONNECT,RESOURCE TO JHI,DONG,KJH;








--************************<TIPS>**************************--
/*조회*/
-- CHECK
SELECT * FROM SRP.STUDENT; -- 테이블 조회
SELECT * FROM USER_TABLES; -- 모든 테이블 조회
SELECT * FROM USER_CONSTRAINTS; -- 테이블 제한조회
SELECT * FROM USER_CONS_COLUMNS; -- 테이블 제한 칼럼 조회
SELECT * FROM USER_TAB_PRIVS; -- 테이블별 유저 권한 조회
SELECT * FROM USER_TAB_COLS WHERE TABLE_NAME = 'STUDENT'; --테이블 상세정보 조회

/*수정*/
ALTER TABLE SUBJECT RENAME COLUMN SU_GRSEASONS TO SU_GRSEASON; -- 컬럼 이름수정 

/*삭제*/
DROP PUBLIC SYNONYM SU; -- 공용 시노님 삭제 시키기
--*********************************************************--








-------------------------------------- SCHOOL 테이블 생성
/* CREATE TABLE */
CREATE TABLE SCHOOL(
    SC_CODE NCHAR(4),
    SC_ADD NVARCHAR2(30),
    SC_NAME NVARCHAR2(10)
)TABLESPACE USERS;
/* PROPERTY */
ALTER TABLE SCHOOL
MODIFY SC_ADD NOT NULL
MODIFY SC_NAME NOT NULL;
/* CONSTRAINTS */
ALTER TABLE SCHOOL
ADD CONSTRAINT SC_CODE_PK PRIMARY KEY (SC_CODE);
/* SYNONYM */
CREATE PUBLIC SYNONYM SC FOR SRP.SCHOOL; 
/* GRANT */
GRANT SELECT ON SC TO JHI,DONG,KJH;


-------------------------------------- STUDENT 테이블 생성
/* CREATE TABLE */
CREATE TABLE STUDENT(
    ST_CODE NCHAR(12),
    ST_NAME NVARCHAR2(5),
    ST_STATE NCHAR(1)
)TABLESPACE USERS; 
/* PROPERTY */
ALTER TABLE STUDENT
MODIFY ST_NAME NOT NULL
MODIFY ST_STATE NOT NULL;
/* CONSTRAINTS */
ALTER TABLE STUDENT
ADD CONSTRAINT ST_CODE_PK PRIMARY KEY (ST_CODE);

/* SYNONYM */
CREATE PUBLIC SYNONYM ST FOR SRP.STUDENT;
/* GRANT */
GRANT SELECT ON ST TO JHI,DONG,KJH;


-------------------------------------- SUBJECT 테이블 생성
/* TABLE */
CREATE TABLE SUBJECT(
    SU_STCODE NCHAR(12),
    SU_CLCODE NCHAR(3),
    SU_GRSEASONS NCHAR(2),
    SU_KOREAN NUMBER(3,0),
    SU_ENGLISH NUMBER(3,0),
    SU_MATH NUMBER(3,0),
    SU_SOCIETY NUMBER(3,0),
    SU_SCIENCE NUMBER(3,0)
)TABLESPACE USERS;

-- TABLE COLUMN NAME 변경
ALTER TABLE SUBJECT RENAME COLUMN SU_GRSEASONS TO SU_GRSEASON;

/* PROPERTY */
ALTER TABLE SUBJECT
MODIFY SU_KOREAN DEFAULT 0
MODIFY SU_ENGLISH DEFAULT 0
MODIFY SU_MATH DEFAULT 0
MODIFY SU_SOCIETY DEFAULT 0
MODIFY SU_SCIENCE DEFAULT 0;
/* CONSTRAINTS */
ALTER TABLE SUBJECT
ADD CONSTRAINT SU_STCODE_CLCODE_GRSEASON_PK PRIMARY KEY(SU_STCODE, SU_CLCODE, SU_GRSEASON);
ALTER TABLE SUBJECT
ADD CONSTRAINT CL_STCODE_CLCODE_FK FOREIGN KEY(SU_STCODE, SU_CLCODE) REFERENCES "CLASS"(CL_STCODE, CL_CODE);
ALTER TABLE SUBJECT
ADD CONSTRAINT SU_GRSEASON_FK FOREIGN KEY(SU_GRSEASON) REFERENCES GRADE(GR_SEASON);
/* SYNONYM */
SELECT * FROM GR;

CREATE PUBLIC SYNONYM SU FOR SRP.SUBJECT;
/* GRANT */
GRANT SELECT ON SU TO JHI,DONG,KJH;

SELECT * FROM USER_CONS_COLUMNS
WHERE TABLE_NAME = 'SUBJECT';


-------------------------------------- TEACHER 테이블 생성
CREATE TABLE TEACHER(
TE_SCCODE NCHAR(4),
TE_CODE NCHAR(4),
TE_NAME NVARCHAR2(5),
TE_NUMBER NUMBER(11),
TE_LEVEL NCHAR(1),
TE_PWD NCHAR(4),
TE_SAYEARS NVARCHAR2(2)
)TABLESPACE USERS;

ALTER TABLE TEACHER
MODIFY TE_NAME NOT NULL
MODIFY TE_LEVEL NOT NULL
MODIFY TE_PWD NOT NULL;

ALTER TABLE TEACHER
ADD CONSTRAINT TE_SCCODE_CODE_PK PRIMARY KEY(TE_SCCODE, TE_CODE)
ADD CONSTRAINT TE_SCCODE_FK FOREIGN KEY(TE_SCCODE) REFERENCES SCHOOL(SC_CODE);

ALTER TABLE TEACHER
ADD CONSTRAINT TE_SAYEARS_FK FOREIGN KEY(TE_SAYEARS) REFERENCES SRP.SALARY(SA_YEARS);

SELECT * FROM USER_CONSTRAINTS;

CREATE PUBLIC SYNONYM TE FOR SRP.TEACHER;


-------------------------------------- CLASS 테이블 생성

CREATE TABLE "CLASS"(
CL_SCCODE NCHAR(4),
CL_TECODE NCHAR(4),
CL_STCODE NCHAR(12),
CL_CODE NCHAR(3)
) TABLESPACE USERS;

ALTER TABLE "CLASS"
ADD CONSTRAINT CL__STCODE_CODE_PK PRIMARY KEY(CL_STCODE, CL_CODE)
ADD CONSTRAINT CL_SCCODE_FK FOREIGN KEY(CL_SCCODE,CL_TECODE) REFERENCES SRP.TEACHER(TE_SCCODE, TE_CODE);

CREATE PUBLIC SYNONYM CL FOR SRP."CLASS";


-------------------------------------- ATTENDANCE 테이블 생성

CREATE TABLE ATTENDANCE(
AT_STCODE NCHAR(12),
AT_STATE NCHAR(1),
AT_DATE DATE
) TABLESPACE USERS;

ALTER TABLE ATTENDANCE
MODIFY AT_STATE NOT NULL;

ALTER TABLE ATTENDANCE
MODIFY AT_DATE DEFAULT SYSDATE;
ALTER TABLE ATTENDANCE
ADD CONSTRAINT AT_STCODE_DATE_PK PRIMARY KEY (AT_STCODE, AT_DATE)

ALTER TABLE ATTENDANCE
ADD CONSTRAINT AT_STCODE_FK FOREIGN KEY (AT_STCODE) REFERENCES SRP.STUDENT(ST_CODE);

CREATE PUBLIC SYNONYM AT FOR SRP.ATTENDANCE;

CREATE TABLE GRADE(
GR_TECODE NCHAR(4),
GR_SEASON NCHAR(2),
GR_TESCCODE NCHAR(4)
)TABLESPACE USERS;

-------------------------------------- GRADE 테이블 생성
ALTER TABLE GRADE
ADD CONSTRAINT GR_SEASON_PK PRIMARY KEY(GR_SEASON);

ALTER TABLE GRADE
ADD CONSTRAINT GR_TECODE_TESCCODE_FK FOREIGN KEY(GR_TECODE,GR_TESCCODE) REFERENCES SRP.TEACHER(TE_CODE,TE_SCCODE);


CREATE PUBLIC SYNONYM GR FOR SRP.GRADE;


-------------------------------------- COMMENT 테이블 생성
CREATE TABLE "COMMENT"(
CO_STCODE NCHAR(12),
CO_TECODE NCHAR(4),
CO_CLCODE NCHAR(3),
CO_COMMENT NVARCHAR2(100)
)TABLESPACE USERS;

ALTER TABLE "COMMENT"
ADD CO_TESCCODE NCHAR(4);
COMMIT;

ALTER TABLE "COMMENT"
MODIFY CO_COMMENT DEFAULT '내용없음';

ALTER TABLE "COMMENT"
ADD CONSTRAINT CO_STCODE_CLCODE_FK FOREIGN KEY (CO_STCODE,CO_CLCODE) REFERENCES SRP."CLASS"(CL_STCODE,CL_CODE);


ALTER TABLE "COMMENT"
ADD CONSTRAINT CO_TECODE_TESCCODE_FK FOREIGN KEY (CO_TECODE,CO_TESCCODE) REFERENCES SRP.teacher(TE_CODE,TE_SCCODE);


CREATE PUBLIC SYNONYM CO FOR SRP."COMMENT";

-------------------------------------- REPORT 테이블 생성
CREATE TABLE "REPORT"(
RE_DATE DATE,
RE_STCODE NCHAR(12),
RE_REPLY NVARCHAR2(100),
RE_TELEVEL NCHAR(1),
RE_STATE NCHAR(1)
)TABLESPACE USERS;

ALTER TABLE "REPORT"
MODIFY RE_STATE NOT NULL;

ALTER TABLE "REPORT"
MODIFY RE_REPLY DEFAULT '내용없음';

ALTER TABLE "REPORT"
ADD CONSTRAINT RE_DATE_STCODE_PK PRIMARY KEY(RE_DATE,RE_STCODE);

ALTER TABLE "REPORT"
ADD CONSTRAINT RE_STCODE_FK FOREIGN KEY(RE_STCODE) REFERENCES SRP.STUDENT(ST_CODE);

CREATE PUBLIC SYNONYM RE FOR SRP."REPORT";


-------------------------------------- HISTORY 테이블 생성
CREATE TABLE HISTORY(
HI_SCCODE     NCHAR(4),
HI_TECODE   NCHAR(4),
HI_TIME     DATE,
HI_STATE    NCHAR(1)
)TABLESPACE USERS;

--PROPERTY
ALTER TABLE HISTORY
MODIFY HI_STATE NOT NULL;
ALTER TABLE HISTORY
MODIFY HI_TIME DEFAULT SYSDATE;

--CONSTRAINTS
ALTER TABLE HISTORY
ADD CONSTRAINT HI_SCCODE_TECODE_TIME_PK PRIMARY KEY(HI_SCCODE,HI_TECODE,HI_TIME);
ALTER TABLE HISTORY
ADD CONSTRAINT HI_SCCODE_TECODE_FK FOREIGN KEY(HI_SCCODE,HI_TECODE) REFERENCES TEACHER(TE_SCCODE,TE_CODE);

ALTER TABLE HISTORY 
DROP CONSTRAINT HI_SCCODE_FK;

--SYNONYM
CREATE PUBLIC SYNONYM SA FOR SRP.HISTORY;

-------------------------------------- SALARY 테이블 생성
CREATE TABLE SALARY(
SA_YEARS     NVARCHAR2(2),
SA_MONEY    NUMBER(7)
)TABLESPACE USERS;

--PROPERTY
ALTER TABLE SALARY
MODIFY SA_MONEY NOT NULL;

ALTER TABLE SALARY
ADD CONSTRAINT SA_YEARS_PK PRIMARY KEY(SA_YEARS);

--SYNONYM
CREATE PUBLIC SYNONYM SA FOR SRP.SALARY;


-------------------------------------- PRIZE 테이블 생성
CREATE TABLE PRIZE(
PR_CLCODE   NCHAR(3),
PR_STCODE   NCHAR(12),
PR_NAME     NVARCHAR2(10)
)TABLESPACE USERS;

--PROPERTY
ALTER TABLE PRIZE
MODIFY PR_NAME  DEFAULT '내용 없음';

--CONSTRAINTS

ALTER TABLE PRIZE
DROP CONSTRAINT PR_STCODE_FK;

ALTER TABLE PRIZE
ADD CONSTRAINT PR_CLCODE_STCODE_PK PRIMARY KEY(PR_CLCODE,PR_STCODE);
ALTER TABLE PRIZE
ADD CONSTRAINT PR_CLCODE_STCODE_FK FOREIGN KEY (PR_CLCODE, PR_STCODE) REFERENCES "CLASS"(CL_CODE, CL_STCODE);
ALTER TABLE PRIZE
ADD CONSTRAINT PR_STCODE_FK FOREIGN KEY (PR_STCODE) REFERENCES STUDENT(ST_CODE);

--SYNONYM
CREATE PUBLIC SYNONYM PR FOR SRP.PRIZE;




